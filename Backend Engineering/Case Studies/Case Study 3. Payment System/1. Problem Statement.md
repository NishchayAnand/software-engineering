
PSP notifies payment-service via a webhook.

payment service create a payment intent with the PSP. The PSP returns a secret id 

![payment-flow](payment-flow-pg.jpg.png)

---

```mermaid
sequenceDiagram
  participant Client
  participant ReservationSvc
  participant InventorySvc
  participant PaymentSvc
  participant Razorpay
  Client->>ReservationSvc: POST /api/reservations (idempotency-key, items, user)
  ReservationSvc->>InventorySvc: POST /api/holds (idempotency-key, items)
  alt inventory OK
    InventorySvc-->>ReservationSvc: 201 { holdId, expiresAt, amount }
    ReservationSvc->>PaymentSvc: POST /api/payments/orders (holdId, amount, currency, receipt)
    alt order OK
      PaymentSvc-->>ReservationSvc: 201 { orderId, keyId, amount }
      ReservationSvc-->>Client: 201 { reservationId, holdId, orderId, expiresAt, keyId }
    else order FAIL
      PaymentSvc-->>ReservationSvc: 5xx / 4xx
      ReservationSvc->>InventorySvc: POST /api/holds/{holdId}/cancel  (compensate)
      ReservationSvc-->>Client: 503 / 409 (explain failure)
    end
  else inventory FAIL
    InventorySvc-->>ReservationSvc: 409 (insufficient inventory)
    ReservationSvc-->>Client: 409 (show unavailable)
  end

```

---

Are we dealing with currency exchange?

Different regions may have different sets of payment methods.

Do we need to support cash-based payment.

---

