
The **Attendance Management System** should allow a **teacher (main actor)** to perform **key actions (use cases)** such as:

1. Create a new class.
2. Add a student to an assigned class.
3. Mark daily class attendance.
4. Generate monthly class attendance reports.

Let’s understand the step-by-step sequence flow of each use case to gain deeper insights into <span style="color:green;font-weight:bold;background:beige;">how teachers interact with the system, how data flows during runtime, and how each feature functions within a memory-only environment</span>.

---
### Create a New Class

This use case allows a teacher to define a new class at the beginning of an academic session. The following interactions describe the step-by-step flow of this operation between the user interface and backend components.

**Interaction 1: Click the "Create Class" Button**

1. A `Teacher` initiates the process by clicking the `Create Class` button from the UI. 
2. The UI displays the class creation form and prompts the teacher to enter class details such as `className` and `teacherName`.

**Interaction 2: Submit the "Create Class" Form**

1. Upon submitting the form, the frontend sends a `POST /create-class` request to the `AttendanceManagementSystem`, including the input class details. 
2. The `AttendanceManagementSystem` intercepts the request, extracts request parameters: `className` and `teacherName`, and invokes the `createClass(className, teacherName)` method within the `ClassService`.
3. The `createClass()` method validates if a class with the same name already exists. Upon successful validation, it generates a unique `classId`, instantiates a new `ClassObject`  and saves the `{classId, classObject}` combination in the in-memory class registry.
4. An `HTTP response` is returned to the UI, stating whether the class has been created or not.

**Sequence Diagram**

```mermaid
sequenceDiagram
	participant T as Teacher
	participant UI as Frontend UI
	participant AMS as AttendanceManagementSystem
	participant CS as ClassService

	Note over T,CS: Create New Class - Complete Flow

	%% Interaction 1: Click the "Create Class" Button
	T->>+UI: Click "Create Class" button
	UI-->>-T: Display class creation form

	%% Interaction 2: Submit the "Create Class" Form
	T->>+UI: Fill "Create Class" form and click Submit
	Note right of T: Enter Details: <br/> Class Name: "Mathematics - Grade 10" <br/> Teacher Name: "Mrs. Anjali Sharma"
	UI->>+AMS: POST /createClass
	AMS->>+CS: createClass(className, teacherName)

	alt Class already exists
		CS-->>AMS: return error: "Class already exists"
		AMS-->>UI: return HTTP 409 Conflict
		UI-->>T: Show error: "Class already exists"
	else Create New Class
		Note left of CS: 1. Generate unique classId <br/> 2. Instantiate new ClassObject <br/> 3. Save {classId, classObject}
		CS-->>-AMS: return classObject
		AMS-->>-UI: return HTTP 200 OK
		UI-->>-T: Show confirmation: "Class created successfully!"
	end
```

---
### Add a Student to Existing Class

This use case enables a teacher to add a new student to one of its assigned class. The following interactions outline the complete step-by-step flow from initiating the action to successful student registration.

**Interaction 1: Click the "Add Student" Button**

1. The `Teacher` begins the process by clicking the `Add Student` button from the UI. 
2. The UI displays the add student details form and sends a `GET request` to the `AttendanceManagementSystem` to pre-populate class dropdown menu with the list of classes assigned to the `Teacher`. 

**Interaction 2: Submit the "Add Student Details" Form**

1. The `Teacher` selects the desired class (e.g., `Mathematics Grade 10`) and enters student details such as `name` and `enrollmentId`.
2. Upon submitting the form, the frontend sends a `POST /addStudent` request to the `AttendanceManagementSystem`, including the selected `classId` and the student's details.
3. The `AttendanceManagementSystem` intercepts the request, extracts request parameters: `classId`, `name` and `enrollmentId`, and invokes the `addStudent(classID, studentName, enrollmentNumber)` method within the `ClassService`.
4. The `addStudent()` method validates if a student with the same `enrollmentId` already exists in the target class. Upon successful validation, it generates a unique a unique `rollNumber`, instantiates a new `studentObject` and adds the the `{enrollmentId, studentObject}` combination to the student collection of the target class.
5. An `HTTP response` is returned to the UI, confirming whether the student has been added to the target class or not.

**Sequence Diagram**

```mermaid
sequenceDiagram
	participant T as Teacher
	participant UI as Frontend UI
	participant AMS as AttendanceManagementSystem
	participant CS as ClassService
	participant CR as ClassRepository

	Note over T,CR: Add Student to Class - Complete Flow

	%% Interaction 1: Click the "Add Student" Button
	T->>+UI: Click "Add Student" button
	UI->>+AMS: GET /classes
	AMS->>+CS: getAllClasses()
	CS->>+CR: findAll()
	CR-->>-CS: return List<Class>
	CS-->>-AMS: return List<Class>
	AMS-->>-UI: HTTP 200 OK
	UI-->>-T: Show "Student Details" form

	%% Interaction 2: Submit the "Add Student Details" Form
	T->>+UI: Select class and enter student details
	Note right of T: Class ID: "CLASS_0001"<br/>Student Name: "Alice Johnson" <br/>Roll Number: "1"
	UI->>+AMS: POST /addStudent
	Note right of UI: { "classId": "CLASS_0001",<br/> "studentName": "Alice Johnson",<br/> "rollNumber": "1" }
	AMS->>+CS: addStudentToClass("CLASS_0001", "Alice Johnson", "1")
	CS->>+CR: findById("CLASS_0001")
	Note right of CS: Retrieve the target class
	CR->>CR: classObj = classes.get("CLASS_0001")
	CR-->>-CS: return classObj
	alt Roll Number Already Exists
		CS->>CS: classObj.getStudentMap().containsKey("1")
		CS-->>AMS: return error: "Roll Number already exists"
		AMS-->>UI: HTTP 409 Conflict
		UI-->>T: Show error: "Roll Number already exists"
	else New Student Creation
		CS->>CS: studentObj = new Student("Alice Johnson", "1")
		CS->>CS: classObj.getStudentMap().put("1", studentObj)
		CS-->>-AMS: return message: "Student Added Successfully"
		AMS-->>-UI: HTTP 200 OK
		UI-->>-T: Show message: "Student Added Successfully"
	end
```

> **NOTE:** 
> 
> For **in-memory system**, where the teacher creates classes and adds students **per session**, it's better to **let the teacher input the roll number**. This provides more control and aligns well with existing school records or legacy systems.

---
### Mark Daily Attendance

This use case allows a teacher to record daily attendance for students in a selected class. The interactions below describe this flow in detail.

**Interaction 1: Click the "Mark Attendance" Button**

1. The `Teacher` begins the process by clicking the "Mark Attendance" button from the UI. 
2. The UI displays a "Select Class" form and sends a `GET /classes` request to the `AttendanceManagementSystem` to pre-populate the class dropdown menu with the list of existing classes.

**Interaction 2: Fill the "Mark" Form**

1. The `Teacher` selects the desired class (e.g., "Mathematics Grade 10"). 
2. The UI displays the mark attendance form, showcasing `List<Student>` in the selected `Class` and prompting the `Teacher` to go through each `Student` and mark its `AttendanceStatus` as `Present` or `Absent`.

**Interaction 3: Submit "Mark Attendance" Form**

1. Upon submitting the form, the frontend sends a `POST /markAttendance` request to the `AttendanceManagementSystem`, including `todayDate`, `classId` and `Map<rollNumber, AttendanceStatus>`. 
2. The `AttendanceManagementSystem` extracts request parameters: `todayDate`, `classId` and `Map<rollNumber, AttendanceStatus>`, and invokes the  `markAttendance(classId,todayDate,Map<rollNumber, AttendanceStatus>)` method within the `AttendanceService`.
3. The `markAttendance()` method performs basic validations, such as ensuring that the `Map<rollNumber, AttendanceStatus>` for `todayDate` for the target class is not already present in the `AttendanceRecords`. 
4. If the validation succeeds, a new `Map<todayDate, Map<rollNumber, AttendanceStatus>` entry is added to the `AttendanceRecords` of the target class via the `save(classId, Map<todayDate, Map<rollNumber, AttendanceStatus>)` method of `AttendanceRepository`.
5. Finally, the `AttendanceManagementSystem` returns a success response to the UI, confirming the attendance for all students in the target class is marked for today.

**Sequence Diagram**

```mermaid
sequenceDiagram
	participant T as Teacher
	participant UI as Frontend UI
	participant AMS as AttendanceManagementSystem
	participant AS as AttendanceService
	participant AR as AttendanceRepository
	participant CS as ClassService
	participant CR as ClassRepository

	Note over T, CR: Mark Daily Attendance - Complete Flow

	%%Interaction 1: Click the "Mark Attendance" Button
	T->>+UI: Click "Mark Attendance" button
	UI->>+AMS: GET /classes
	AMS->>+CS: getAllClasses()
	CS->>+CR: findAll()
	CR-->>-CS: return List<Class>
	CS-->>-AMS: return List<Class>
	AMS-->>-UI: HTTP 200 OK
	UI-->>-T: Display class dropdown

	%%Interaction 2: Fill the "Mark" Form
	T->>+UI: Select class and date
	Note right of T: Class ID: "CLASS_0001" <br/> Date: "6-Aug-2025"
	UI->>+AMS: GET /students?classId=CLASS_0001
	AMS->>+CS: getAllStudentsInClass("CLASS_0001")
	CS->>+CR: getAllStudents("CLASS_0001")
	CR-->>-CS: return List<Student>
	CS-->>-AMS: return List<Student>
	AMS-->-UI: HTTP 200 OK
	UI-->>-T: Display student list with Present/Absent options

	%%Interaction 3: Submit "Mark Attendance" Form
	T->>+UI: Mark attendance for each student
	UI->>+AMS: POST /markAttendance
	Note right of UI: { "classId": "CLASS_0001", <br/> "todayDate": "6-Aug-2025", <br/> "attendanceMap": {rollNumber, AttendanceStatus} }
	AMS->>+AS: markAttendance(classId, todayDate, Map<rollNumber, AttendanceStatus>)
	Note right of AMS: Delegate to service layer

	AS->>+AR: isAttendanceMarked(classId, todayDate)
	alt Attendance Already Marked
		AR-->>AS: true
        AS-->>AMS: return error: "Attendance already exists"
        AMS-->>UI: HTTP 409 Conflict
        UI-->>T: Show error: "Attendance already exists"
    else Mark Attendance
        AR-->>-AS: false
        AS->>+AR: save("CLASS_0001", Map<todayDate, Map<rollNumber, AttendanceStatus>)
        AR-->>-AS: attendanceRecord.put("CLASS_0001", Map<todayDate, Map<rollNumber, AttendanceStatus>)
        AS-->>-AMS: Success
        AMS-->>-UI: HTTP 200 OK
        UI-->>-T: Show success message: "Attendance marked successfully"
    end
```

> **NOTE:** 
> 
> It's better to store **attendance records as a separate entity** rather than embedding them inside the **`Class`** object. 
> 
> While storing attendance within `Class` object keeps everything in one place, it tightly couples responsibilities and makes the class harder to manage. Let the **`Class`** object focus only on class metadata and enrolled students. 
> 
> This aligns with the **Single Responsibility Principle** and makes the system easier to extend for features like reporting or persistence later.

---
### Generate Monthly Class Attendance Report

This use case allows a teacher to generate and view the monthly attendance summary for a selected class. The interactions below illustrate the step-by-step process of how this report is generated and delivered to the teacher through the UI.

**Interaction 1: Click the "View Attendance Report" button**

1. The `Teacher` clicks the "View Attendance Report" button from the UI. 
2. The frontend sends a `GET /classes` request to the `AttendanceManagementSystem` to pre-populate the class dropdown menu with the list of existing classes and prompts the `Teacher` to choose a specific class (e.g., "Mathematics Grade 10"), year and month.

**Interaction 2: Submit "Select Class and Month" Form**

1. Upon submitting the form, the frontend sends a `GET /attendanceReport` request to the `AttendanceManagementSystem`, including the selected `classId`, `year` and `month` as parameters.
2. The `AttendanceManagementSystem` extracts request parameters: `classId`, `year` and `month`, and invokes the  `generateClassAttendanceReport(classId,year, month)` method within the `ReportService`.
3. The `generateClassAttendanceReport()` method invokes the `getAttendanceRecord(classId)` method within the `AttendanceRepository` to retrieve the `AttendanceRecord` for the specified class and performs basic validations such as ensuring that at least one record exist in the `AttendanceRecord` that fall within the given month. 
4. If the validation succeeds, it aggregates `AttendanceRecord` to compute, for each `Student`, the number of days marked as `Present` and `Absent`. The resulting `ClassAttendanceReport` is structured as a `List<StudentAttendanceStats>`, containing every student's attendance summaries for the month.
5. Finally, the `AttendanceManagementSystem` returns the aggregated `ClassAttendanceReport` to the frontend, where it is typically presented in a tabular format like:

| Roll Number | Name  | Total Present | Total Absent | Attendance % |
| ----------- | ----- | ------------- | ------------ | ------------ |
| 1           | Alice | 20            | 2            | 91.3         |
| 2           | Bob   | 18            | 3            | 86.9         |

**Sequence Diagram**

```mermaid
sequenceDiagram
    participant T as Teacher
    participant UI as Frontend UI
    participant AMS as AttendanceManagementSystem
    participant RS as ReportService
    participant AR as AttendanceRepository
    participant CS as ClassService
    participant CR as ClassRepository

    Note over T,CR: View Monthly Class Attendance Report – Complete Flow

	%%Interaction 1: Click the "View Attendance Report" button
    T->>+UI: Click "View Attendance Report"
    UI->>+AMS: GET /classes
    AMS->>+CS: getAllClasses()
	CS->>+CR: findAll()
	CR-->>-CS: Return List<Class>
	CS-->>-AMS: Return List<Class>
	AMS-->>-UI: HTTP 200 OK
	UI-->>-T: Display class dropdown

	%%Interaction 2: Submit "Select Class and Month" Form
    T->>+UI: Select class, year, and month
    Note right of T: e.g., ClassId = "CLASS_0001", Year = 2025, Month = 08
    UI->>+AMS: GET /attendanceReport?classId=CLASS_0001&year=2025&month=08
    AMS->>+RS: generateAttendanceReport("CLASS_0001", 2025, 8)
    Note right of AMS: Delegate to reporting service
    RS->>+AR: getAttendanceRecord("CLASS_0001")
    AR-->>-RS: Return Map<LocalDate, Map<rollNumber, AttendanceStatus>>
    Note over RS: Filter records for year = 2015 & month = 08
	alt Records exist for the given month
		Note over RS: Compute Present/Absent per student
		RS-->>AMS: Return List<StudentAttendanceStats>
		AMS-->>UI: HTTP 200 OK with ClassAttendanceReport
		UI-->>T: Display tabular report: Student Name, Roll No., Present, Absent
	else No records found for the given month
		RS-->>-AMS: Return "No Records Found" message
		AMS-->>-UI: Return "No Records Found" response
		UI-->>-T: Display "No Records Found" message
	end
```

---




